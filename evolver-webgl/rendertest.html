<html>

<body>
    <canvas id="c" width="1024" height="1024" style="width: 300px; height: 300px; border: 1px solid black;"></canvas>
    <script type="text/javascript" src="js/triangle.js"></script>
    <script type="text/javascript" src="js/renderer.js"></script>
    <script type="text/javascript" src="js/mutator.js"></script>
    <script id="2d-vertex-shader" type="notjs">
 
            // an attribute will receive data from a buffer
            attribute vec2 a_position;
            attribute vec4 a_color;
            uniform vec2 u_resolution;
            varying vec4 v_color;
           
            // all shaders have a main function
            void main() {
                // convert the position from pixels to 0.0 to 1.0
                vec2 zeroToOne = a_position / u_resolution;
             
                // convert from 0->1 to 0->2
                vec2 zeroToTwo = zeroToOne * 2.0;
             
                // convert from 0->2 to -1->+1 (clipspace)
                vec2 clipSpace = zeroToTwo - 1.0;
             
                gl_Position = vec4(clipSpace, 0, 1);
                v_color = a_color;
            }
           
          </script>

    <script id="2d-fragment-shader" type="notjs">
           
            // fragment shaders don't have a default precision so we need
            // to pick one. mediump is a good default
            precision mediump float;

            varying vec4 v_color;
           
            void main() {
              // gl_FragColor is a special variable a fragment shader
              // is responsible for setting
              gl_FragColor = v_color;
            }
           
  </script>
  <script type="text/javascript" src="webgl-utils.js">
  </script>
  <script type="text/javascript" src="js/triangle.js"></script>
  <script type="text/javascript" src="js/renderer.js"></script>
  <script type="text/javascript" src="js/mutator.js"></script>

    <script type="text/javascript">
        function createShader(gl, type, source) {
            var shader = gl.createShader(type);
            gl.shaderSource(shader, source);
            gl.compileShader(shader);
            var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);
            if (success) {
                return shader;
            }

            console.log(gl.getShaderInfoLog(shader));
            gl.deleteShader(shader);
        }

        function createProgram(gl, vertexShader, fragmentShader) {
            var program = gl.createProgram();
            gl.attachShader(program, vertexShader);
            gl.attachShader(program, fragmentShader);
            gl.linkProgram(program);
            var success = gl.getProgramParameter(program, gl.LINK_STATUS);
            if (success) {
                return program;
            }

            console.log(gl.getProgramInfoLog(program));
            gl.deleteProgram(program);
        }

        function main() {
            // Get A WebGL context
            var canvas = document.getElementById("c");
            var gl = canvas.getContext("webgl");
            if (!gl) {
                return;
            }

            // Get the strings for our GLSL shaders
            var vertexShaderSource = document.getElementById("2d-vertex-shader").text;
            var fragmentShaderSource = document.getElementById("2d-fragment-shader").text;

            // create GLSL shaders, upload the GLSL source, compile the shaders
            var vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);
            var fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSource);

            // Link the two shaders into a program
            var program = createProgram(gl, vertexShader, fragmentShader);
            var mutator = new Mutator(gl.canvas.width, gl.canvas.height);
            var renderer = new Renderer(gl, program);

            window.setInterval(function() {
                var triangles = [];
                for (var i = 0; i < 1000; i++) {
                    var triangle = new Triangle();
                    mutator.randomizeTriangle(triangle);
                    triangles.push(triangle);
                }
                renderer.render(triangles);
            }, 1);
        }
        main();
    </script>
</body>

</html>