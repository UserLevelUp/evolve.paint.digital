<html>

<head>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
</head>

<body>

    <script id="focus-vertex-shader" type="notjs">
        attribute vec2 a_position;
        attribute vec2 a_texCoord;
        varying vec2 v_texCoord;

        void main() {
            gl_Position = vec4(a_position, 0, 1.);
            v_texCoord = a_texCoord;
        }
    </script>

    <script id="focus-fragment-shader" type="notjs">
        // fragment shaders don't have a default precision so we need
        // to pick one. mediump is a good default
        precision highp float;

        varying vec2 v_texCoord;
        uniform sampler2D u_src;
        uniform sampler2D u_focus;
        
        void main() {
            // gl_FragColor is a special variable a fragment shader
            // is responsible for setting
            // vec4 color = texture2D(u_src, v_texCoord);
            // gl_FragColor = color;
            vec4 srcColor = texture2D(u_src, v_texCoord);
            vec4 focusColor = texture2D(u_focus, v_texCoord);
            vec4 clr = (srcColor + focusColor) / 2;
            gl_FragColor = vec4(clr.rgb, 1.);
        }
    </script>

    <script type="text/javascript" src="webgl-utils.js"></script>
    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="js/util.js"></script>
    <canvas id="c" width="1024" height="1024" style="width: 300px; border: 1px solid black;"></canvas>

    <script type="text/javascript">
        var srcImage = new Image();
        srcImage.src = "catpic.jpg";
        srcImage.onload = function () {
            start();
        }

        function start() {
            var canvas = document.getElementById("c");
            var gl = canvas.getContext("webgl");
            if (!gl) {
                throw new Error("Could not initialize webgl context");
            }
            var focusProgram = createProgram(gl, "focus");
            gl.useProgram(focusProgram);

            var srcTexture = createAndSetupTexture(gl, 0);
            gl.textImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, srcImage);
            // // Create textures for comparison.
            // var texture1 = createAndSetupTexture(gl, 0);
            // // Upload the image into the texture.
            // gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image1);

            // var texture2 = createAndSetupTexture(gl, 1);
            // // Upload the image into the texture.
            // gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image2);
        }
    </script>
</body>

</html>
